yum install -y vim-enhanced git http://yum.puppetlabs.com/puppetlabs-release-el-7.noarch.rpm https://anorien.csc.warwick.ac.uk/mirrors/epel/beta/7/x86_64/epel-release-7-0.2.noarch.rpm http://yum.theforeman.org/nightly/el7/x86_64/mod_passenger-4.0.18-9.5.el7.x86_64.rpm http://yum.theforeman.org/nightly/el7/x86_64/rubygem-passenger-native-4.0.18-9.5.el7.x86_64.rpm http://yum.theforeman.org/nightly/el7/x86_64/rubygem-passenger-native-libs-4.0.18-9.5.el7.x86_64.rpm http://yum.theforeman.org/nightly/el7/x86_64/rubygem-passenger-4.0.18-9.5.el7.x86_64.rpm http://yum.theforeman.org/nightly/el7/x86_64/rubygem-rack-1.4.5-3.el7.noarch.rpm http://yum.theforeman.org/nightly/el7/x86_64/rubygem-rack-doc-1.4.5-3.el7.noarch.rpm 

yum -y install puppet
mkdir -p /tmp/modules

puppet module install stephenrjohnson/puppet --modulepath=/tmp/modules
rm -rf /tmp/modules/puppet/templates/puppet_passenger.conf.erb

echo "PassengerHighPerformance on
PassengerPoolIdleTime 1500
# PassengerMaxRequests 1000
PassengerStatThrottleRate 120
PassengerTempDir /var/run/rubygem-passenger" > /tmp/modules/puppet/templates/puppet_passenger.conf.erb

puppet apply --modulepath=/tmp/modules --execute "class{'::puppet::master':}"
rm -rf /tmp/modules