EXPECTED_ARGS=1
E_BADARGS=65
OS_MAJ_VERSION=$(rpm -qa \*-release | grep -Ei "oracle|redhat|centos" | cut -d"-" -f3)
 
if [ $# -ne $EXPECTED_ARGS ]
then
  echo "Usage: $0 master_hostname"
  exit $E_BADARGS
fi
 
MASTER_HOSTNAME=$1
 
yum install -y http://yum.puppetlabs.com/puppetlabs-release-el-"$OS_MAJ_VERSION".noarch.rpm || true
yum -y install puppet
 
echo "[main]
    logdir = /var/log/puppet
    rundir = /var/run/puppet
    ssldir = $vardir/ssl
    server = $MASTER_HOSTNAME

[agent]
    classfile = $vardir/classes.txt
    localconfig = $vardir/localconfig" > /etc/puppet/puppet.conf

puppet resource service puppet ensure=running enable=true
